<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>íŒ€ ê´€ë¦¬</title>
  <link rel="stylesheet" href="/static/css/reset.css" />
  <link rel="stylesheet" href="/static/css/teamSetting.css" />
  <link rel="stylesheet" href="/static/css/m-teamSetting.css" />
  <script
          src="https://code.jquery.com/jquery-3.6.1.min.js"
          integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
          crossorigin="anonymous"
  ></script>
  <script src="/static/js/jQueryCheck.js"></script>
</head>
<body>
<div class="wrap">
  <h1 class="title">íŒ€ ê´€ë¦¬</h1>
  <div class="contentWrap">
    <div class="teamProfile">
      <p class="subTitle">íŒ€ í”„ë¡œí•„</p>
      <div class="article">
        <input
                type="text"
                name="teamName"
                id="teamName"
                class="input_text"
                th:value="${teamDto.getTeamName()}"
                disabled
        />
        <input type="hidden" id="teamSeqHidden" th:value="${teamDto.getTeamSeq()}">
        <div id="updateDiv">
          <button type="button" id="changeTeam" class="editBtn">
            ë³€ê²½
          </button>
        </div>
      </div>
    </div>

    <div class="memberProfile">
      <p class="subTitle">ë©¤ë²„ ê´€ë¦¬</p>
      <div th:if="${teamMemberDtoList!=null}">
        <th:block th:each="teamMemberDtoList : ${teamMemberDtoList}">
          <div class="article">
            <div class="metaData">
              <img th:src="${teamMemberDtoList.getMemberImgSysName=='/static/img/defaultProfileImg.png' ? '/static/img/defaultProfileImg.png' :
              '/member/selectProfileImg/' + teamMemberDtoList.getMemberImgSysName }" alt="" class="profileImg" />
              <div class="texts">
                <input
                        type="text"
                        name="memberName"
                        class="inputText"
                        th:value="${teamMemberDtoList.getTeamMemberNickname}"
                        readonly
                        disabled
                />
                <input
                        type="text"
                        name="memberEmail"
                        class="inputEmail"
                        th:value="${teamMemberDtoList.getMemberId}"
                        readonly
                        disabled
                />
              </div>
            </div>
            <div class="btns">
              <button
                      type="button"
                      name="grade"
                      class="gradeBtn"
                      th:data-nick-name="${teamMemberDtoList.getTeamMemberNickname}"
                      th:data-memberSeq="${teamMemberDtoList.getMemberSeq}"
                      th:data-teamSeq="${teamDto.getTeamSeq}"
                      th:data-session="${sessionMemberSeq}"
                      th:data-owner="${teamDto.getTeamOwnerSeq}"
                      th:text="${teamMemberDtoList.getGrade}"
              >
              </button>
              <th:block th:if="${teamMemberDtoList.getGrade!='ë§¤ë‹ˆì €'}">
              <button type="submit" class="delBtn" id="delMember"
                      th:data-nick-name="${teamMemberDtoList.getTeamMemberNickname}"
                      th:data-memberSeq="${teamMemberDtoList.getMemberSeq}"
                      th:data-teamSeq="${teamDto.getTeamSeq}">
                ê°•í‡´
              </button>
              </th:block>
            </div>
          </div>
        </th:block>
      </div>
    </div>
  </div>

  <!-- ë“±ê¸‰ ë³€ê²½ ì°½ -->
  <div class="modal">
    <div class="modalWrap">
      <h1>ğŸ¤”</h1>
      <h3 id="h3"></h3>
      <button id="master" class="modalBtn">ë§¤ë‹ˆì €</button>
      <button id="manager" class="modalBtn">ë¶€ë§¤ë‹ˆì €</button>
      <button id="staff" class="modalBtn">íŒ€ì›</button>
      <button id="goBack" type="button" onclick="closer()">ë‚˜ê°€ê¸°</button>
    </div>
  </div>

  <!-- ë“±ê¸‰ ë°”ê¿€ê±´ì§€ ë¬»ëŠ” ì°½ -->
  <div class="modal1">
    <div class="modalWrap1">
      <h1>ğŸ¤”</h1>
      <h3 id="h3_1"></h3>
      <button class="yesNoBtn">ì˜ˆ</button>
      <button class="yesNoBtn">ì•„ë‹ˆìš”</button>
      <button id="goBack1" type="button" onclick="closer1()">ë‚˜ê°€ê¸°</button>
    </div>
  </div>

  <!-- íŒ€ ê°•í‡´ ì°½ -->
  <div class="modal2">
    <div class="modalWrap2">
      <h1>ğŸ¤”</h1>
      <h3 id="h3_2"></h3>
      <button class="okNoBtn">ì˜ˆ</button>
      <button class="okNoBtn">ì•„ë‹ˆìš”</button>
      <button id="goBack2" type="button" onclick="closer2()">ë‚˜ê°€ê¸°</button>
    </div>
  </div>

  <strong><a href="/member/loginIndex" id="loginIndex">ë’¤ë¡œê°€ê¸°</a></strong>
  <th:block th:if="${teamDto.getTeamOwnerSeq==sessionMemberSeq}">
  <form action="/team/deleteTeam" id="deleteTeam" method="post">
    <input type="hidden" name="teamSeq" id="teamSeq" th:value="${teamDto.getTeamSeq()}">
    <p style="text-align: center; margin-top: 20px;">íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? <a href="#" onclick="delClick()"><strong>ì‚­ì œ</strong></a></p>
  </form>
  </th:block>
</div>
<script>
  let oriGrade;
  let thisNickName;
  let changeGrade;
  let yesNo;
  let okNo;
  let memberSeq;
  let teamSeq;

  //ë§¤ë‹ˆì €ëŠ” ìê¸° ë“±ê¸‰ ë³€ê²½ ë¶ˆê°€ëŠ¥
  $(function (){
    $(".gradeBtn").eq(0).attr("disabled",true);
  })

  // modal ì—´ë¦¼ í•¨ìˆ˜ ( ë“±ê¸‰ ë³€ê²½ ì°½ )
  $(".gradeBtn").on("click",function (){
    $(".modal").css("display","block");
    memberSeq=$(this).data("memberseq");
    teamSeq=$(this).data("teamseq");
    thisNickName=$(this).data("nick-name");
    oriGrade = $(this).text();
    $("#h3").html(thisNickName +"ë‹˜ì˜ ë“±ê¸‰ì„ <br/> ì–´ë–»ê²Œ ë³€ê²½í• ê¹Œìš”?");
  })

  // modal1 ( ë“±ê¸‰ ë°”ê¿€ê±´ì§€ ë¬»ëŠ” ì°½)
  $(".modalBtn").on("click",function (){
    $(".modal").css("display","none");
    $(".modal1").css("display","block");
    changeGrade=$(this).text();
    $("#h3_1").html(thisNickName +"ë‹˜ì˜ ë“±ê¸‰ì„ <br/>"+oriGrade+" ì—ì„œ "+changeGrade+" (ìœ¼)ë¡œ ë³€ê²½í• ê¹Œìš”?");
  })

  //'ì˜ˆ' ëˆ„ë¥´ë©´ ë“±ê¸‰ ë³€ê²½ ë˜ëŠ” ajax
  $(".yesNoBtn").on("click",function () {
    yesNo = $(this).text();
    let enGrade = changeGrade;
    if (yesNo == "ì˜ˆ") {
      $.ajax({
        url: "/team/updateTeamMemberGrade",
        data: {
          "grade": enGrade,
          "memberSeq": memberSeq,
          "teamSeq":teamSeq
        },
        type:"post",
        success: function () {
        }, error: function () {
        }
      }).done(function () {
        location.reload();
        if(changeGrade=="ë§¤ë‹ˆì €"){
          location.href="/member/loginIndex"
        }else {
          $(".modal1").css("display", "none");
        }
      })
    }  else {
      $(".modal1").css("display", "none");
    }
  })

  // modal2 ì—´ë¦¼ í•¨ìˆ˜ ( íŒ€ì› ê°•í‡´ )
  $(".delBtn").on("click",function (){
    $(".modal2").css("display","block");
    memberSeq=$(this).data("memberseq");
    thisNickName=$(this).data("nick-name");
    teamSeq=$(this).data("teamseq");
    $("#h3_2").html(thisNickName +"ë‹˜ì„ ê°•í‡´ ì‹œí‚¤ê² ìŠµë‹ˆê¹Œ?");
  })

  //'ì˜ˆ' ëˆ„ë¥´ë©´ íŒ€ì› ê°•í‡´ë˜ëŠ” ajax
  $(".okNoBtn").on("click",function () {
    okNo = $(this).text();

    if (okNo == "ì˜ˆ") {
      $.ajax({
        url: "/team/deleteTeamMember",
        data: {
          "memberSeq": memberSeq,
          "teamSeq":teamSeq
        },
        type:"post",
        success: function () {
        }, error: function () {
        }
      }).done(function () {
        location.reload();
      })
    }  else {
      $(".modal2").css("display", "none");
    }
  })

  // modal ë‹«í˜ í•¨ìˆ˜ ( ë“±ê¸‰ ë³€ê²½ ì°½ )
  function closer() {
    $(".modal").css("display","none");
  }

  // modal1 ë‹«í˜ í•¨ìˆ˜ ( ë“±ê¸‰ ë°”ê¿€ê±´ì§€ ë¬»ëŠ” ì°½ )
  function closer1() {
    $(".modal1").css("display","none");
  }

  // modal2 ë‹«í˜ í•¨ìˆ˜ ( íŒ€ì› ê°•í‡´ ì°½ )
  function closer2() {
    $(".modal2").css("display","none");
  }

  // íŒ€ ì‚­ì œ ì‹œ ê²½ê³ ë©”ì„¸ì§€
  function delClick() {
    if (confirm("íŒ€ì„ ì •ë§ ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      $("#deleteTeam").submit();
      alert("íŒ€ì´ ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤");
      return true;
    } else {
      alert("ì˜ ìƒê°í•˜ì…¨ì–´ìš”!");
      return false;
    }
  }

</script>

<script>
  //íŒ€ ì´ë¦„ ë³€ê²½
  let updateTeamNameBtn = $("<button>");
  updateTeamNameBtn.text("ì™„ë£Œ");
  updateTeamNameBtn.attr("type", "button");
  updateTeamNameBtn.attr("id", "updateTeamNameBtn");
  updateTeamNameBtn.attr("class","editBtn");

  $("#changeTeam").on("click",function (){
    $("#teamName").attr("disabled", false);
    $("#changeTeam").css("display","none");
    $("#teamName").css("border","2px dashed magenta");
    $('#updateDiv').append(updateTeamNameBtn);
  })

  updateTeamNameBtn.on("click",function () {
    let teamName = $("#teamName").val();
    let teamSeq = $("#teamSeqHidden").val();
    $.ajax({
      url: "/team/updateTeamName",
      data: {
        "teamName": teamName,
        "teamSeq": teamSeq
      },
      success: function () {
      }, error: function () {
      }
    }).done(function () {
      alert("íŒ€ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
      $("#teamName").val(teamName);
      $("#teamName").attr("disabled", true);
      $("#changeTeam").css("display","block");
      updateTeamNameBtn.css("display","none");
      $("#teamName").css("border", "none");
    })
  })
</script>

</body>
</html>
