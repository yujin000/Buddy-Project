<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ë‹¹ì‹ ì˜ ë™ë£Œ, ì˜ì›í•œ ì¹œêµ¬ buddy</title>
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/team.css"/>
    <link rel="stylesheet" href="/static/css/m-team.css"/>
    <script
            src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
            crossorigin="anonymous"
    ></script>
    <script src="/static/js/jQueryCheck.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gothic+A1&family=Nanum+Gothic&family=Noto+Sans+KR&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>
<body>

<script th:inline="javascript">
    // íƒ€ì„ë¦¬í”„ë¡œ ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë³€ìˆ˜ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë³€ìˆ˜ë¡œ ì„ ì–¸í•œ ê³µê°„.
    /*<![CDATA[*/
    let chatRoomSeq = [[${chatRoomSeq}]];
    let teamMemberNickname = [[${session.teamMemberNickname}]];
    let memberSeq = [[${session.memberSeq}]];
    let memberImgSysName = [[${memberImgSysName}]];
    /*]]>*/

</script>

<!--ì„¸ì…˜ ë° ê°ì¢… ë³€ìˆ˜ë¥¼ ë‹´ì•„ ì“°ëŠ” input-->
<input type="hidden"
       th:data-sessionMemberSeq="${session.memberSeq}"
       th:data-team="${session.teamSeq}"
       th:data-grade="${teamMemberInfo.grade}"
       th:data-teamSeq="${session.teamSeq}"
       id="infoData"
>

<script>

    function updateScroll() {
        var element = $(".msgView")[0];
        element.scrollTop = element.scrollHeight;
    }

    $(function () {
        // ì›¹ì†Œì¼“ ì˜ì—­ ì‹œì‘
        // webSocket ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        let ws = new WebSocket("ws://localhost/chat/" + chatRoomSeq);

        //ì±„íŒ…ë°© ëª©ë¡ì„ ì¶œë ¥í•´ì£¼ëŠ” ajax
        $.ajax({
            type: "post",
            url: "/chatRoom/chatRoomList",
        }).done(function (resp) {

            let chatRoomList = JSON.parse(resp);

            for (let i = 0; i < chatRoomList.length; i++) {
                let chatRoomListLi = $("<li>");
                let chatRoomListForm = $("<form>");
                let chatRoomInput = $("<input>");
                chatRoomInput.attr("type", "hidden");
                chatRoomInput.val(chatRoomList[i].chatRoomSeq);
                chatRoomInput.attr("name", "chatRoomSeq");
                chatRoomListForm.append(chatRoomInput);
                chatRoomListForm.attr("action", "/chatRoom/join");
                chatRoomListForm.attr("method", "get");
                chatRoomListLi.text(chatRoomList[i].chatTitle);
                chatRoomListLi.append(chatRoomListForm);
                chatRoomListLi.addClass("chatRoom");
                $("#chatListUl").append(chatRoomListLi);
            }
        });

        //íŒ€ëª©ë¡ì„ ì¶œë ¥í•´ì£¼ëŠ” ajaxí˜¸ì¶œ
        $.ajax({
            type: "post",
            url: "/team/teamList"
        }).done(function (resp) {
            let teamList = JSON.parse(resp);
            for (let i = 0; i < teamList.length; i++) {
                let teamListLi = $("<li>");
                let teamListForm = $("<form>");
                let teamListInput = $("<input>");
                teamListInput.attr("type", "hidden");
                teamListInput.val(teamList[i].teamSeq);
                teamListInput.attr("name", "teamSeq");
                teamListForm.attr("action", "/team/goTeam");
                teamListForm.attr("method", "post");
                teamListForm.append(teamListInput);
                teamListLi.text(teamList[i].teamName);
                teamListLi.append(teamListForm);
                teamListLi.addClass("goTeam");
                $("#dropdownList").append(teamListLi);
            }
        });

        //íŒ€ ì´ë™ í´ë¦­ì´ë²¤íŠ¸
        $(document).on("click", ".goTeam", function () {
            $(this).children("form").submit();
        })

        //ì±„íŒ…ë°© ì´ë™ í´ë¦­ì´ë²¤íŠ¸
        $(document).on("click", ".chatRoom", function () {
            $(this).children("form").submit();
        })

        // ë©”ì„¸ì§€ ìˆ˜ì‹ ì‹œ ë©”ì„¸ì§€ ì¶œë ¥
        ws.onmessage = function (e) {
            let data = JSON.parse(e.data);
            let msg = $("<div>");
            let memberImg = $("<div>");
            let msgData = $("<div>");

            let pTag = $("<p>");
            let content = $("<div>");
            let chatDate = $("<p>");

            pTag.addClass("teamMemberNickname");
            pTag.append(data.teamMemberNickname);
            content.append(data.chatContent);

            chatDate.addClass("chaDate");
            chatDate.append(data.chatDate);

            msg.addClass("msg");
            memberImg.addClass('memberImg');
            memberImg.append(data.memberImgSysName);
            msgData.addClass('msgData');
            msgData.append(pTag);
            msgData.append(content);
            msgData.append(chatDate);


            msg.append(memberImg);
            msg.append(msgData);
            //msgData.append(data.teamMemberNickname);
            //msgData.append(data.chatContent);
            //msgData.append(data.chatDate);

            $(".msgView").append(msg);
            updateScroll();
        }

        let file = $("#uploadfile").val();
        $("#inputMsg").on("keydown", function (e) {
            if (e.keyCode == 13 && !e.shiftKey) {
                if(file == "") {
                    // Json ìƒì„±
                    let wsJson = {
                        "memberImgSysName":"<img src="+memberImgSysName+"/>",
                        "chatRoomSeq": chatRoomSeq,
                        "teamMemberNickname": teamMemberNickname,
                        "chatContent": $(this).val(),
                        "memberSeq": memberSeq,
                        "chatMsgType": 0
                    };
                    //JSON ì „ì†¡
                    $(this).val("");
                    ws.send(JSON.stringify(wsJson));
                    return false;
                }
            }
        });

        $("#uploadfile").on('change', attachType);

        function attachType(e) {
            if (e.target.files[0]) {
                if (e.target.files[0].size > (1 * 1024 * 1024)) {
                    alert("íŒŒì¼ ì‚¬ì´ì¦ˆëŠ” 1MB ì´ë‚´ë¡œ ë“±ë¡í•´ì£¼ì„¸ìš”.");
                    this.value = "";
                }
            }
        }

        $(".fileSubmitBtn").on('click', function () {
            $.ajax({
                type: "POST",
                url: "/chatFile/insert",
                data: new FormData($("#uploadfileForm")[0]),
                processData: false,
                contentType: false,
                success: function (rsp) {
                    let chatSysName = rsp.chatSysName;
                    let chatOriName = rsp.chatOriName;
                    let ext = chatOriName.split('.').pop().toLowerCase();
                    if ($.inArray(ext, ['jpg', 'jpeg', 'png', 'gif']) != -1) {
                        let wsJson = {
                            "memberImgSysName":"<img src="+memberImgSysName+"/>",
                            "chatRoomSeq": chatRoomSeq,
                            "teamMemberNickname": teamMemberNickname,
                            "chatContent": "<img src='/chatImg/"+chatSysName+"' style='width: 200px'><br><a href='/chatFile/download?chatSysName=" + chatSysName + "&chatOriName=" + chatOriName + "' style='color: blue'>" + chatOriName + "</a>",
                            "memberSeq": memberSeq,
                            "chatMsgType": 1
                        };
                        //JSON ì „ì†¡
                        $("#uploadfile").val("");
                        $(".fileView").toggle();
                        ws.send(JSON.stringify(wsJson));
                        return false;
                    } else {
                        let wsJson = {
                            "memberImgSysName":"<img src="+memberImgSysName+"/>",
                            "chatRoomSeq": chatRoomSeq,
                            "teamMemberNickname": teamMemberNickname,
                            "chatContent": "<img src='/static/img/fileImg.png 'style='width: 200px'><br><a href='/chatFile/download?chatSysName=" + chatSysName + "&chatOriName=" + chatOriName + "' style='color: blue'>" + chatOriName + "</a>",
                            "memberSeq": memberSeq,
                            "chatMsgType": 1
                        };
                        //JSON ì „ì†¡
                        $("#uploadfile").val("");
                        $(".fileView").toggle();
                        ws.send(JSON.stringify(wsJson));
                        return false;
                    }
                }
            });
        })

        //ì´ëª¨í‹°ì½˜ í´ë¦­ ì‹œ ì´ëª¨í‹°ì½˜ ë³´ë‚´ê¸°
        let clickEmoticon;
        $(document).on("click",".emoticonImg",function(){
            clickEmoticon=$(this).data("sysname");
            clickEmoticon="/emoticon/"+clickEmoticon;
            //ì´ëª¨í‹°ì½˜ë§Œ ë³´ë‚´ê¸°
            if(clickEmoticon.length!=""){
                let wsJson = {
                    "memberImgSysName":"<img src='"+memberImgSysName+">",
                    "chatRoomSeq": chatRoomSeq,
                    "teamMemberNickname": teamMemberNickname,
                    "chatContent": "<img src='"+clickEmoticon+"'style='width: 160px'>",
                    "memberSeq": memberSeq,
                    "chatMsgType": 1
                };
                //JSON ì „ì†¡
                $(this).val("");
                $("#emoticonClickImg").attr("src","");
                $(".emoticonView").hide();
                ws.send(JSON.stringify(wsJson));
                return false;
            }
        })
    });

    //ì±„íŒ…ë°© ë©¤ë²„ë“¤ ì¶œë ¥
    $.ajax({
        url:"/chatRoom/selectChatMember",
        data:{"chatRoomSeq": chatRoomSeq},
        success : function (){
        },error : function (){
        }
    }).done(function (rsp){
        let JsonChatMemberList = JSON.parse(rsp);
        for (let i=0; i<JsonChatMemberList.length; i++) {
            let ChatMemberListLi = $("<li>");
            let ChatMemberListImg = $("<img>");
            let ChatMemberListSpan1 = $("<span>");
            let ChatMemberListSpan2 = $("<span>");
            ChatMemberListImg.attr("src",JsonChatMemberList[i].memberImgSysName=='/static/img/defaultProfileImg.png' ? '/static/img/defaultProfileImg.png' : '/member/selectProfileImg/' + JsonChatMemberList[i].memberImgSysName);
            ChatMemberListLi.append(ChatMemberListImg);
            ChatMemberListSpan1.text(JsonChatMemberList[i].teamMemberNickname);
            ChatMemberListLi.append(ChatMemberListSpan1);
            ChatMemberListSpan2.text(JsonChatMemberList[i].grade);
            ChatMemberListLi.append(ChatMemberListSpan2);
            $("#memberList").append(ChatMemberListLi);
        }
    });

</script>

<div class="wrap">
    <div class="header">
        <div class="logo">
            <a href="#">
                <img src="/static/img/logo_m2.png" alt=""/>
            </a>
        </div>
        <div id="teamList" class="teamList">
            <ul>
                <li>
                    <span class="teamName" href="team.html" th:text="${session.teamName}"></span
                    >
                    <button id="headerToggle">
                        <span class="material-symbols-outlined">
arrow_drop_down
</span></button>
                </li>
            </ul>
            <ul id="dropdownList">
                <h1 id="dropdownTitle">
                    íŒ€ë¦¬ìŠ¤íŠ¸
                </h1>
            </ul>
        </div>

        <button id="menu" class="iconMenu"><span class="material-symbols-outlined">
menu
</span></button>
        <button id="asideClose"><img src="/static/img/logo_emotion.png" alt="" ></button>
        <button id="teamMember"><span class="material-symbols-outlined">
group
</span></button>
        <ul id="teamMemberList" class="teamMemberList">
            <h1>íŒ€ì› ëª©ë¡</h1>
        </ul>

    </div>

    <div class="main">
        <aside>
            <div id="profile" class="asideTitle">
                <img id="myImg" th:src="${memberImgSysName}" alt="" />
                <div id="profileView" th:text="${teamMemberInfo.getTeamMemberNickname()}"></div>
            </div>

            <div id="topic" class="asideList">
                <div class="asideTitle">
                    <h3>í† í”½ <span id="topicCount">[[${topicCount}]]</span><span> / 4</span></h3>
                    <button id="topicToggle" class="toggle">â–</button>
                    <th:block th:if="${teamMemberInfo.grade=='ë§¤ë‹ˆì €'||teamMemberInfo.grade=='ë¶€ë§¤ë‹ˆì €'}">
                        <button id="topicCreate" class="createBtn">â•</button>
                    </th:block>
                </div>
                <div id="topicList" class="asideItem">
                    <ul th:each="topicList : ${topicList}">
                        <li>
                            <a th:href="@{/chatRoom/join/(chatRoomSeq=${topicList.chatRoomSeq})}">[[${topicList.chatTitle}]]</a>
                            <button type="button" class="topicRename" th:data-index="${topicList.chatRoomSeq}">âœï¸</button>
                            <button type="button" class="topicDel" th:data-index="${topicList.chatRoomSeq}">âŒ</button>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="chat" class="asideList">
                <div class="asideTitle">
                    <h3>ì±„íŒ…</h3>
                    <button id="chatCreate" class="createBtn">â•</button>
                    <button id="chatToggle" class="toggle">â–</button>
                </div>
                <div id="chatList" class="asideItem">
                    <ul th:if="${chatRoomList!=null}">
                        <th:block th:each="chatRoomList : ${chatRoomList}">
                            <li>
                                <a th:href="@{/chatRoom/join/(chatRoomSeq=${chatRoomList.chatRoomSeq})}"
                                   th:text="${chatRoomList.chatTitle}"></a>
                                <button th:if="${#strings.equals(chatRoomList.chatType,'normal')}"
                                        class="chatRename" th:data-index="${chatRoomList.chatRoomSeq}">
                                    âœï¸
                                </button>
                                <button th:if="${#strings.equals(chatRoomList.chatType,'normal')}"
                                        class="chatOut" th:data-index="${chatRoomList.chatRoomSeq}">
                                    âŒ
                                </button>
                            </li>
                        </th:block>
                    </ul>
                </div>
            </div>

            <div class="asideTool">
                <button id="appToggle" class="appToggle">buddy App</button>
                <div id="appList">
                    <button class="app" id="appDrive"><a href="/drive/toFileDrive">ğŸ“ë“œë¼ì´ë¸Œ</a></button>
                    <button class="app" id="appCal"><a href="/calendar/moveCalendar">ğŸ“…ìº˜ë¦°ë”</a></button>
                </div>
            </div>
        </aside>
        <div id="profileViewDiv" class="check">
            <img id="profileImg" class="check" th:src="${memberImgSysName}"><br/>
            <div id="nickNameDiv" class="check">
          <span id="nickNameSpan" class="check" th:text="${teamMemberInfo.getTeamMemberNickname()}" onclick="nickNameSpanClick()">
            nickname
          </span>
                <button id="updateNickNameBtn" class="check elseCheck">ìˆ˜ì •</button>
            </div>
            <div id="gradeDiv" class="check">
        <span id="pGrade" class="check" th:text="${teamMemberInfo.grade}">
          ë“±ê¸‰
          </span>
            </div>
        </div>
        <section class="msgSection">
            <div class="chatHeader">
                <h1 th:text="${chatRoomName}"></h1>
                <button id="memberView">
                    <span class="material-symbols-outlined">
face
</span>
                </button>
            </div>
            <div class="msgView">

                <div id="subSection">
                    <ul id="memberList" class="subItem">
                        <h1>ì±„íŒ…ë©¤ë²„</h1>
                    </ul>
                </div>

                <th:block th:each="chatMsgList : ${chatMsgList}">
                    <div class="msg">
                        <div  class="memberImg" th:utext="${chatMsgList.memberImgSysName}">
                        </div>
                        <div class="msgData">
                            <p class="teamMemberNickname">[[${chatMsgList.teamMemberNickname}]]</p>
                            <div th:if="${chatMsgList.chatMsgType == 0}" th:text="${chatMsgList.chatContent}"></div>
                            <div th:if="${chatMsgList.chatMsgType == 1}" th:utext="${chatMsgList.chatContent}"></div>
                            <p class="chaDate">[[${chatMsgList.chatDate}]]</p>
                        </div>
                    </div>
                </th:block>
            </div>
            <div class="msgSend">
                <input
                        type="text"
                        name="inputMsg"
                        id="inputMsg"
                        class="inputMsg"
                        placeholder="ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                />
                <div class="msgTool">
                    <ul>

                        <li><button type="button" id="emoticonBtn">ğŸ˜Š</button></li>
                        <div class="emoticonView">
                            <div id="emoticonList">

                            </div>
                        </div>
                        <li>
                            <button type="button" id="fileSelect" class="aside">@</button>
                        </li>
                    </ul>
                    <form action="/chatFile/insert" method="post" enctype="multipart/form-data" id="uploadfileForm">
                        <div class="fileView">
                            <input type="hidden" th:value="${chatRoomSeq}" name="chatRoomSeq">
                            <ul>

                                <h3>
                                    âœ…ë‚´ ì»´í“¨í„°ì—ì„œ ì—…ë¡œë“œ</h3>
                            </ul>
                            <div class="fileContents">
                                <input
                                        type="file"
                                        name="uploadfile"
                                        id="uploadfile"
                                        class="uploadfile"
                                        accept=".txt,.xls,.ppt,.hwp,.jpg,.png,.gif,.mp4,.mp3,.zip"/>

                                <button type="button" class="fileSubmitBtn" style="height: 30px">ë³´ë‚´ê¸°</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</div>
<div id="menuList" class="menuList">
    <ul>
        <li><a href="/member/logout">logout</a></li>
        <li><a href="/team/teamOut">ë²„ë”” ë©”ì¸ìœ¼ë¡œ</a></li>
        <li><a href="/qna/main">ë¬¸ì˜í•˜ê¸° ë° news</a></li>
        <li id="teamWithdraw">íŒ€ íƒˆí‡´</li>
        <li class="inviteMember">íŒ€ì›ì´ˆëŒ€</li>
    </ul>
</div>

<div class="createView" id="createView">
    <div class="wrap">
        <div class="chatForm" id="chatForm">
            <h1>ğŸ˜€ì±„íŒ… ì‹œì‘í•˜ê¸°</h1>
            <ul class="list" id="chatMemberUl">
                <li><input type="text" placeholder="ì±„íŒ…ë°© ì´ë¦„" id="makeChatTitle"></li>
            </ul>
            <button type="button" id="startChat">ëŒ€í™” ì‹œì‘í•˜ê¸°</button>
            <button type="button" class="closeBtn" id="closeBtn" onclick="closer(this)">ë‚˜ê°€ê¸°</button>
        </div>


        <div class="topicForm" id="topicForm">
            <h1>âœ¨í† í”½ ìƒì„±í•˜ê¸°</h1>
            <ul class="list">
                <li><input class="topicTitle" id="topicTitle" type="text" placeholder="í† í”½ ì´ë¦„" ></li>
            </ul>
            <button type="button" class="insertTopic" id="insertTopic">í† í”½ ìƒì„±í•˜ê¸°</button>
            <button type="button" class="closeBtn" onclick="closer(this)">ë‚˜ê°€ê¸°</button>
        </div>
    </div>

    </div>

<div class="renameView" id="renameView">
    <div class="wrap2">

        <div class="renameForm" id="renameTopic" >
            <h1>í† í”½ ì´ë¦„ ë³€ê²½</h1>
            <input type="text" id="modifyTopicTitle" class="modifyTitle" placeholder=" í† í”½/ì±„íŒ…ë°© ì œëª©ë³€ê²½">
            <button type="button" id="modifyTopicConfirm" class="modifyBtn">ë³€ê²½í•˜ê¸°</button>
            <button type="button" id="modifyCancel" class="closeBtn" onclick="closer(this)">ë‚˜ê°€ê¸°</button>
        </div>

        <div class="renameForm" id="renameChat" >
            <h1>ì±„íŒ… ì´ë¦„ ë³€ê²½</h1>
            <input type="text" id="modifyChatTitle" class="modifyTitle" placeholder=" í† í”½/ì±„íŒ…ë°© ì œëª©ë³€ê²½">
            <button type="button" id="modifyChatConfirm" class="modifyBtn">ë³€ê²½í•˜ê¸°</button>
            <button type="button" id="modifyCancel2" class="closeBtn" onclick="closer(this)">ë‚˜ê°€ê¸°</button>
        </div>

    </div>
</div>
    <script th:inline="javascript">
        $(function (){
        $.ajax({
            url:"/team/teamMemberList",
            success : function (){
            },error : function (){
            }
        }).done(function (rsp){
            let JsonTeamMemberList = JSON.parse(rsp);
            //íŒ€ í™”ë©´ì—ì„œ íŒ€ ëª©ë¡ì„ ì¶œë ¥
            for (let i=0; i<JsonTeamMemberList.length; i++) {
                let teamMemberListLi = $("<li>");
                let teamMemberListImg = $("<img>");
                let teamMemberListSpan1 = $("<span>");
                let teamMemberListSpan2 = $("<span>");
                teamMemberListImg.attr("src",JsonTeamMemberList[i].memberImgSysName=='/static/img/defaultProfileImg.png' ? '/static/img/defaultProfileImg.png' : '/member/selectProfileImg/' + JsonTeamMemberList[i].memberImgSysName);
                teamMemberListLi.append(teamMemberListImg);
                teamMemberListSpan1.text(JsonTeamMemberList[i].teamMemberNickname);
                teamMemberListLi.append(teamMemberListSpan1);
                teamMemberListSpan2.text(JsonTeamMemberList[i].grade);
                teamMemberListLi.append(teamMemberListSpan2);
                $("#teamMemberList").append(teamMemberListLi);
            }
            for (let i=0; i<JsonTeamMemberList.length; i++) {
                //ì±„íŒ…ë°© ë§Œë“¤ê¸°ì—ì„œ íŒ€ ëª©ë¡ì„ ì¶œë ¥
                let chatMemberLi = $("<li>");
                let chatMemberImg = $("<img>");
                let chatMemberSpan1 = $("<span>");
                let chatMemberSpan2 = $("<span>");
                chatMemberLi.addClass("makeTeamMember");
                chatMemberLi.attr("data-checked", "false");
                chatMemberLi.attr("data-memberSeq", JsonTeamMemberList[i].memberSeq);
                chatMemberImg.attr("src",JsonTeamMemberList[i].memberImgSysName=='/static/img/defaultProfileImg.png' ? '/static/img/defaultProfileImg.png' : '/member/selectProfileImg/' + JsonTeamMemberList[i].memberImgSysName);
                chatMemberLi.append(chatMemberImg);
                chatMemberSpan1.text(JsonTeamMemberList[i].teamMemberNickname);
                chatMemberLi.append(chatMemberSpan1);
                chatMemberSpan2.attr('class','tag');
                chatMemberSpan2.css('color','#8621F7');
                chatMemberSpan2.text(JsonTeamMemberList[i].grade);
                chatMemberLi.append(chatMemberSpan2);
                $("#chatMemberUl").append(chatMemberLi);
            }
        })
    })
</script>
<script>

    //íŒ€ ì´ë™ í´ë¦­ì´ë²¤íŠ¸
    $(document).on("click", ".goTeam", function (){
        //console.log();
        $(this).children("form").submit();
    })
</script>
<script>

    $("#appCal").on("click",function(){
        location.href = "/calendar/moveCalendar";
    })

    $(document).ready(function () {
        $("#headerToggle").click(function () {
            $("#dropdownList").toggle();
        });

        $("#menu").click(function () {
            $("#menuList").toggle();
        });

        $("#topicToggle").click(function () {
            $("#topicList").toggle();
        });

        $("#chatToggle").click(function () {
            $("#chatList").toggle();
        });

        $("#asideClose").click(function () {
            $("aside").toggle();
        });

        $("#appToggle").click(function () {
            $("#appList").toggle();
        });

        $("#teamMember").click(function (){
            $("#teamMemberList").toggle();
        })


        $("#memberView").click(function () {
            $("#memberList").toggle();
        });

        $("#fileSelect").click(function () {
            $(".fileView").toggle();
            $(".emoticonView").hide();
        });

        $("#chatCreate").click(function (){
            $("#createView").css("display","block");
            $("#chatForm").css("display","block");
            $("#topicForm").css("display","none");
        })

        $("#topicCreate").click(function (){
            console.log($("#topicCount").text());
            if ($("#topicCount").text()>=4) {
                alert("ë”ì´ìƒ í† í”½ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!")
            } else {
                $("#createView").toggle();
                $(".topicForm").css("display","block");
                $(".chatForm").css("display","none");

            }

        })

        $("#profileView").on("click",function (){
            $("#profileViewDiv").toggle();
            BtnClick();
        })


    });
</script>

<!-- ë“œë¼ì´ë¸Œ ë²„íŠ¼ í´ë¦­ì‹œ fileDrive í˜ì´ì§€ë¡œ ì´ë™ -->
<script>
    $("#appDrive").on("click", function () {
        location.href = "/drive/toFileDrive";
    });

    function closer(arg) {
        $(arg).parent().parent().parent().css("display","none");
    }
</script>

<script>
    // í† í”½ ìƒì„± ì´ë²¤íŠ¸
    $("#insertTopic").click(function (){
        let chatTitle = $("#topicTitle").val();
        if ($("#topicTitle").val().length==0) {
            alert("ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        } else if ($("#topicTitle").val().length>=15) {
            alert("ì œëª©ì€ 15ìë¥¼ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        } else {
            $.ajax({
                url:"/chatRoom/insertTopic",
                type:"post",
                data:{"chatTitle":chatTitle},
                success : function (){
                    console.log("ì„±ê³µ")
                },error : function (){
                    console.log("ì—ëŸ¬")
                }
            }).done(function (){
                alert("í† í”½ ìƒì„± ì™„ë£Œ!");
                location.reload();
            });
        }
    })
</script>

<script>
    // ì±„íŒ…ë°© ìƒì„±ê´€ë ¨ ì‘ì—…
    let makeChat = new Set();
    $(function () {
        $(document).on("click", ".makeTeamMember", function () {
            if ($(this).attr("data-checked")=="false") {
                $(this).css("background-color", "yellow");
                $(this).attr("data-checked", true);
                makeChat.add($(this).attr("data-memberSeq"));
            } else {
                $(this).css("background-color", "white");
                $(this).attr("data-checked", false);
                makeChat.delete($(this).attr("data-memberSeq"));
            }
        })

        // ì·¨ì†Œë²„íŠ¼ í´ë¦­ì‹œ ìƒˆì±„íŒ…ë°© í›„ë³´ íšŒì› ì´ˆê¸°í™”
        $("#closeBtn").on("click", function () {
            makeChat.clear();
            $("#").css("background-color", "white");
        })

        // ì‹œì‘í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $("#startChat").on("click", function (){
            // ì±„íŒ… ë©¤ë²„ì— ìì‹ ì´ í¬í•¨ë˜ìˆì§€ ì•Šë‹¤ë©´, ë„£ì–´ì¤˜ì•¼í•¨.
            if (!makeChat.has($("#infoData").attr("data-sessionMemberSeq"))) {
                makeChat.add($("#infoData").attr("data-sessionMemberSeq"));
            }
            if (makeChat.size<=1) {
                alert("ì±„íŒ…ë°© ë©¤ë²„ëŠ” 1ì¸ ì´ìƒì˜ íƒ€ íšŒì›ì´ í¬í•¨ë˜ì–´ì•¼í•©ë‹ˆë‹¤.");
            } else if ($("#makeChatTitle").val().length==0) {
                   alert("ì±„íŒ…ë°© ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            } else if($("#makeChatTitle").val().length>15) {
                alert ("ì±„íŒ…ë°© ì´ë¦„ì€ 15ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
            } else {
                let makeChatMember = Array.from(makeChat);
                $.ajax({
                    type:"post",
                    url:"/chatRoom/insertChat",
                    contentType:'application/json',
                    data: JSON.stringify({
                        "chatTitle" : $("#makeChatTitle").val(),
                        "makeChat": makeChatMember
                    })
                }).done(function (resp) {
                    location.reload();
                })
            }
        })

        // í† í”½ ì´ë¦„ ë³€ê²½ ì´ë²¤íŠ¸
        $(".topicRename").click(function (){
            $(".renameView").css("display","block");
            $("#renameTopic").css("display","block");
            $("#renameChat").css("display","none");
            $("#modifyTitleConfirm").attr("data-index", $(this).attr("data-index"));
        })

        $(".chatRename").click(function (){
            $(".renameView").css("display","block");
            $("#renameTopic").css("display","none");
            $("#renameChat").css("display","block");
            $("#modifyTitleConfirm").attr("data-index", $(this).attr("data-index"));
        })

        //ì´ë¦„ ë³€ê²½ ì·¨ì†Œ ë²„íŠ¼ ì´ë²¤íŠ¸
        $("#modifyCancel").click(function (){
            $("#modifyChatTitle").attr("data-index", "");
            $("#modifyChatTitle").val("");
        })

        //ì´ë¦„ ë³€ê²½ í´ë¦­ ì´ë²¤íŠ¸
        $("#modifyTitleConfirm").click(function (){
            let chatRoomSeq = $(this).attr("data-index");
            $.ajax({
                url:"/chatRoom/updateChatTitle",
                type:"post",
                data:{
                    "chatRoomSeq" : chatRoomSeq,
                    "chatTitle" : $("#modifyChatTitle").val()
                }
            }).done(function (resp) {
                alert("ë³€ê²½ ì™„ë£Œ.");
                location.reload();
            })
        })

        //í† í”½ ì‚­ì œ ì´ë²¤íŠ¸
        $(".topicDel").click(function () {
            if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                $.ajax({
                    type : "post",
                    url: "/chatRoom/delChatRoom",
                    data: {"chatRoomSeq" : $(this).attr("data-index")}
                }).done(function (resp){
                    alert("ì‚­ì œì™„ë£Œ!");
                    location.reload();
                });
            }
        })

        //ì¼ë°˜ ì±„íŒ…ë°© ë‚˜ê°€ê¸° ì´ë²¤íŠ¸
        $(".chatOut").click(function () {
            if (confirm("ì •ë§ ì±„íŒ…ë°©ì„ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                let chatRoomSeq = $(this).attr("data-index");
                $.ajax({
                    type:"post",
                    url:"/chatRoom/chatRoomOut",
                    data:{"chatRoomSeq" : chatRoomSeq}
                }).done(function (){
                    location.reload();
                })
            }
        })

        // ì±„íŒ…ë°© íƒˆí‡´ ì´ë²¤íŠ¸
        $("#teamWithdraw").click(function (){
            if ($("#infoData").attr("data-grade")=="ë§¤ë‹ˆì €") {
                alert("ë§¤ë‹ˆì €ëŠ” íŒ€ì„ íƒˆí‡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒ€ ê´€ë¦¬ì—ì„œ ë§¤ë‹ˆì €ë¥¼ ì´ì–‘ í›„ ì§„í–‰í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.");
            } else {
                if (confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    $.ajax({
                        type:"post",
                        url:"/team/teamOut"
                    }).done(function (){
                        alert("íƒˆí‡´ì™„ë£Œ!");
                        location.href = "/";
                    })
                }
            }
        })
    })


</script>

<!-- íŒ€ì› ì´ˆëŒ€ -->
<script>

    let teamSeq = $('#infoData').data('team');

    $('.inviteMember').on('click',function (){
        $.ajax({
            url: "/team/teamMemberCount",
            type: "post",
            data: {"teamSeq" : teamSeq},
        }).done(function(rsp){
            if(rsp >= 8 ){
                alert("ìµœëŒ€ íŒ€ì›ì€ 8ëª… ì…ë‹ˆë‹¤.")
            }else {
                window.open("/invite/sendInviteMail","íŒ€ì› ì´ˆëŒ€","width = 500, height = 300, top = 50%, left = 50%, location = no, toolbars = no, status = no, scrollbars = no");
            }
        })
    });
</script>

<script>
    //ì´ëª¨í‹°ì½˜ ì¶œë ¥
    $("#emoticonBtn").on("click",function (){
        $(".emoticonView").toggle();
        $(".fileView").hide();
    })
    $.ajax({
        url:"/emoticon/selectEmoticon",
        success : function (){
        },error : function (){
        }
    }).done(function (rsp){
        let emoticonList = JSON.parse(rsp);
        for (let i=0; i<emoticonList.length; i++) {
            let emoticonListImg = $("<img>");
            emoticonListImg.attr("class","emoticonImg");
            emoticonListImg.attr("data-sysname",emoticonList[i].emoticonSysName);
            emoticonListImg.attr("src","/emoticon/" + emoticonList[i].emoticonSysName);
            $("#emoticonList").append(emoticonListImg);
        }
    })
</script>

<script th:inline="javascript">
    //íŒ€ì› ë‹‰ë„¤ì„ ë³€ê²½
    let input = $("<input>");
    let button = $("<buuton>");
    function nickNameSpanClick() {
        $("#nickNameSpan").css("display", "none");
        $("#updateNickNameBtn").css("display","inline-block");
        input.attr("class","check");
        $("#inputNickName").css("display","inline-block");
        input.val($("#nickNameSpan").text())
        input.attr("id", "inputNickName");
        $("#nickNameDiv").prepend(input);
        $("#inputNickName").focus();
    }

    function BtnClick(){
        $("#nickNameSpan").css("display", "block");
        $("#inputNickName").css("display","none");
        $("#updateNickNameBtn").css("display","none");

    }
    $("#updateNickNameBtn").on("click",function (){
        let inputNickName = $("#inputNickName").val();
        let teamSeq=$("#infoData").data("teamseq");
        const nickNameRegex = /^[ê°€-í£\s]{1,15}$/;
        let Result = nickNameRegex.test(inputNickName);
        if(Result){
            $.ajax({
                url:"/team/updateTeamMemberNickName",
                type:"post",
                data:{"teamMemberNickname":inputNickName,
                    "teamSeq":teamSeq},
            }).done(function (rsp) {
                console.log(rsp)
                $("#profileView").html(rsp);
                $("#nickNameSpan").text(rsp);
                BtnClick();
                location.reload();
            })}
        else{
            alert("ë‹‰ë„¤ì„ì€ ê³µë°±í¬í•¨ í•œê¸€ 1~15ê¸€ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (íŠ¹ìˆ˜ë¬¸ì ë¶ˆê°€ëŠ¥)");
            $("#inputNickName").focus();
        }
    })

    //profileViewDiv ì°½ ë°–ìœ¼ë¡œ í´ë¦­ ëì„ ë•Œ
    let text = [[${teamMemberInfo.getTeamMemberNickname()}]]
    $("html").click(function(e) {
        if (!$(e.target).hasClass('check')) {
            $("#inputNickName").val(text);
            $("#nickNameSpan").text(text);
        }else if(!$(e.target).hasClass('elseCheck')){
            $("#inputNickName").focus();
        }
    })
</script>
</body>
</html>
